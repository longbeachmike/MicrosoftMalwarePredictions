Train <- as.data.frame( TrainPretraiterEch100000 )

colnames(Train) <- c('ProductName',
                     'EngineVersion',
                     'AppVersion',
                     'AvSigVersion',
                     'IsBeta',
                     'RtpStateBitfield',
                     'IsSxsPassiveMode',
                     'DefaultBrowsersIdentifier',
                     'AVProductStatesIdentifier',
                     'AVProductsInstalled',
                     'AVProductsEnabled',
                     'CountryIdentifier',
                     'OrganizationIdentifier',
                     'Platform',
                     'Processor',
                     'OsVer',
                     'OsBuild',
                     'OsSuite',
                     'OsPlatformSubRelease',
                     'OsBuildLab',
                     'SkuEdition',
                     'IsProtected',
                     'SmartScreen',
                     'FireWall',
                     'Census_MDC2FormFactor',
                     'Census_OEMNameIdentifier',
                     'Census_ProcessorCoreCount',
                     'Census_ProcessorModelIdentifier',
                     'Census_PrimaryDiskTotalCapacity',
                     'Census_systemVolumeTotalCapacity',
                     'Census_HasOpticalDiskDrive',
                     'Census_TotalPhysicalRAM',
                     'Census_InternalPrimaryDiagonalDisplaySizeInInches',
                     'Census_InternalPrimaryDisplayResolutionHorizontal',
                     'Census_InternalPrimaryDisplayResolutionVertical',
                     'Census_PowerPlatformRoleName',
                     'Census_InternalBatteryNumberOfCharges',
                     'Census_OSEdition',
                     'Census_OSInstallTypeName',
                     'Census_OSInstallLanguageIdentifier',
                     'Census_OSWUAutoUpdateOptionsName',
                     'Census_GenuineStateName',
                     'Census_ActivationChannel',
                     'Census_IsSecureBootEnabled',
                     'Census_IsVirtualDevice',
                     'Census_IsTouchEnabled',
                     'Wdft_IsGamer',
                     'Wdft_RegionIdentifier',
                     'HasDetections')
   
                  
Train[,c(8)] <- as.double(gsub(",",".",Train[,c(8)]))                     
Train[,c(9)] <- as.double(gsub(",",".",Train[,c(9)]))                     
Train[,c(12)] <- as.double(gsub(",",".",Train[,c(12)]))                    
Train[,c(13)] <- as.double(gsub(",",".",Train[,c(13)]))                    
Train[,c(20)] <- as.double(gsub(",",".",Train[,c(20)]))                     
Train[,c(26)] <- as.double(gsub(",",".",Train[,c(26)]))                     
Train[,c(28)] <- as.double(gsub(",",".",Train[,c(28)]))
Train <- Train[, -c(8, 9, 12, 13, 20, 26, 28 )]
Train$Census_OSInstallLanguageIdentifier <- as.double(gsub(",",".",Train$Census_OSInstallLanguageIdentifier))                     

Train$Census_InternalBatteryNumberOfCharges <- as.double(gsub(",",".",Train$Census_InternalBatteryNumberOfCharges))                     
Train$OsVer <- as.character(Train$OsVer)
Train$OsSuite <- as.character(Train$OsSuite)
Train$OsBuild <- as.character(Train$OsBuild )               
Train$AVProductsEnabled <- as.character(Train$AVProductsEnabled )               
# Nouvelle variable 
Train$PixelsPerInches <- Train$Census_InternalPrimaryDisplayResolutionHorizontal * Train$Census_InternalPrimaryDisplayResolutionVertical / Train$Census_InternalPrimaryDiagonalDisplaySizeInInches 
Train <- subset(Train, select=-c(IsBeta, Census_InternalPrimaryDisplayResolutionHorizontal, Census_InternalPrimaryDisplayResolutionVertical,  Census_InternalPrimaryDiagonalDisplaySizeInInches))
Train$RamEtTotalCapacity <- log((Train$Census_TotalPhysicalRAM+1) / (Train$Census_systemVolumeTotalCapacity + 1))
Train <- subset(Train, select=-c(Census_TotalPhysicalRAM, Census_systemVolumeTotalCapacity))
Train <- subset(Train, select=-c(AvSigVersion))


summary(Train)
# Analyse en composante principale sur les variables numeriques.
plot(prcomp(Train[,AttributsNumeriques], scale=T))

AttributsNumeriques <- which(sapply(Train, is.numeric) == T)
Train[,AttributsNumeriques] <- sapply(Train[,AttributsNumeriques], function(x) (x - median(x))/sd(x))

AttributsBinaires <- which(sapply(Train, is.logical) == T)
AttributsFacteurs <- which(sapply(Train, is.character) == T)

Train[,AttributsBinaires] <- lapply(Train[,AttributsBinaires], as.numeric)
Train[,AttributsFacteurs] <- lapply(Train[,AttributsFacteurs], as.factor)

# Matrice de correlations
source("http://www.sthda.com/upload/rquery_cormat.r")
rquery.cormat(Train[, c(AttributsNumeriques, AttributsBinaires)])



#### Modele GLM
TrainDummys <- model.matrix( HasDetections ~ ., data=Train[,-AttributsBinaires[1:8]])
yy <- as.data.frame(TrainDummys)
yy <- yy[,-1]
(yy - mean(yy))/sqrt(var(yy))
summary(yy)
dim(Train)
summary(Train)
glm( HasDetections ~ .,data=yy, family = 'binomial')

glm( HasDetections ~ .,data=Train[,c(AttributsBinaires,AttributsNumeriques,35)], family = 'binomial')


glm( HasDetections ~ .,data=as.data.frame(TrainDummys), family = 'binomial')

