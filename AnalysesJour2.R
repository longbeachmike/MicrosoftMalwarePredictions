Train <- as.data.frame( TrainPretraiterEch100000 )

colnames(Train) <- c('ProductName',
                     'EngineVersion',
                     'AppVersion',
                     'AvSigVersion',
                     'IsBeta',
                     'RtpStateBitfield',
                     'IsSxsPassiveMode',
                     'DefaultBrowsersIdentifier',
                     'AVProductStatesIdentifier',
                     'AVProductsInstalled',
                     'AVProductsEnabled',
                     'CountryIdentifier',
                     'OrganizationIdentifier',
                     'Platform',
                     'Processor',
                     'OsVer',
                     'OsBuild',
                     'OsSuite',
                     'OsPlatformSubRelease',
                     'OsBuildLab',
                     'SkuEdition',
                     'IsProtected',
                     'SmartScreen',
                     'FireWall',
                     'Census_MDC2FormFactor',
                     'Census_OEMNameIdentifier',
                     'Census_ProcessorCoreCount',
                     'Census_ProcessorModelIdentifier',
                     'Census_PrimaryDiskTotalCapacity',
                     'Census_systemVolumeTotalCapacity',
                     'Census_HasOpticalDiskDrive',
                     'Census_TotalPhysicalRAM',
                     'Census_InternalPrimaryDiagonalDisplaySizeInInches',
                     'Census_InternalPrimaryDisplayResolutionHorizontal',
                     'Census_InternalPrimaryDisplayResolutionVertical',
                     'Census_PowerPlatformRoleName',
                     'Census_InternalBatteryNumberOfCharges',
                     'Census_OSEdition',
                     'Census_OSInstallTypeName',
                     'Census_OSInstallLanguageIdentifier',
                     'Census_OSWUAutoUpdateOptionsName',
                     'Census_GenuineStateName',
                     'Census_ActivationChannel',
                     'Census_IsSecureBootEnabled',
                     'Census_IsVirtualDevice',
                     'Census_IsTouchEnabled',
                     'Wdft_IsGamer',
                     'Wdft_RegionIdentifier',
                     'HasDetections')


Train[,c(8)] <- as.double(gsub(",",".",Train[,c(8)]))                     
Train[,c(9)] <- as.double(gsub(",",".",Train[,c(9)]))                     
Train[,c(12)] <- as.double(gsub(",",".",Train[,c(12)]))                    
Train[,c(13)] <- as.double(gsub(",",".",Train[,c(13)]))                    
Train[,c(20)] <- as.double(gsub(",",".",Train[,c(20)]))                     
Train[,c(26)] <- as.double(gsub(",",".",Train[,c(26)]))                     
Train[,c(28)] <- as.double(gsub(",",".",Train[,c(28)]))
Train <- Train[, -c(8, 9, 12, 13, 20, 26, 28 )]
Train$Census_OSInstallLanguageIdentifier <- as.double(gsub(",",".",Train$Census_OSInstallLanguageIdentifier))                     

Train$Census_InternalBatteryNumberOfCharges <- as.double(gsub(",",".",Train$Census_InternalBatteryNumberOfCharges))
Train$AppVersion <-  as.character(Train$AppVersion)

Train$OsVer <- as.character(Train$OsVer)
Train$OsSuite <- as.character(Train$OsSuite)
Train$OsBuild <- as.character(Train$OsBuild )               
Train$AVProductsEnabled <- as.character(Train$AVProductsEnabled ) 
Train$RtpStateBitfield <-  as.character(Train$RtpStateBitfield)
Train$AVProductsInstalled <-  as.character(Train$AVProductsInstalled)
Train$Wdft_RegionIdentifier <-  as.character(Train$Wdft_RegionIdentifier)



summary(Train)
# Nouvelle variable 
Train$PixelsPerInches <- Train$Census_InternalPrimaryDisplayResolutionHorizontal * Train$Census_InternalPrimaryDisplayResolutionVertical / Train$Census_InternalPrimaryDiagonalDisplaySizeInInches 
Train <- subset(Train, select=-c( Census_InternalPrimaryDisplayResolutionHorizontal, Census_InternalPrimaryDisplayResolutionVertical,  Census_InternalPrimaryDiagonalDisplaySizeInInches))
Train$RamEtTotalCapacity <- log((Train$Census_TotalPhysicalRAM+1) / (Train$Census_systemVolumeTotalCapacity + 1))
# Enleve
Train <- subset(Train, select=-c(Census_TotalPhysicalRAM, Census_systemVolumeTotalCapacity))
Train <- subset(Train, select=-c(AvSigVersion, IsBeta))

summary(Train)
# Analyse en composante principale sur les variables numeriques.

is.logical2 <- function(x) {
  if(length(unique(x)) == 2 && !any(unique(x) > 1 || unique(x) < 0) ){
    return(T)
  }
  else return(F)
}
AttributsBinaires <- which(sapply(Train, is.logical2) == T) # 12
# On met en logique pour qu'il ne soit pas attrapes par les attributs numeriques
table(Train$AVProductsEnabled)
unique(Train$AVProductsEnabled) > c(0,1) || unique(Train$AVProductsEnabled) == 1
Train[,AttributsBinaires] <- lapply(Train[,AttributsBinaires], as.logical)

# Conversion des attributs numeriques en standardise 
AttributsNumeriques <- which(sapply(Train, is.numeric) == T)
AttributsNumeriques2 <- which(sapply(Train[, AttributsNumeriques], function(x) ifelse(max(x) <= 1 && min(x) >= 0,T,F) ) == F)

Train[,names(AttributsNumeriques2)] <- sapply(Train[,names(AttributsNumeriques2)], function(x) (x - median(x))/sd(x))

# Remet les attributs binaires en 0,1
Train[,AttributsBinaires] <- lapply(Train[,AttributsBinaires], as.numeric)

# Transforme les attributs facteurs en facteurs
AttributsFacteurs <- which(sapply(Train, is.character) == T)
Train[,AttributsFacteurs] <- lapply(Train[,AttributsFacteurs], as.factor)

summary(Train)

# Matrice de correlations
source("http://www.sthda.com/upload/rquery_cormat.r")
rquery.cormat(Train[, c(AttributsNumeriques, AttributsBinaires)])

summary(Train)

#### Modele GLM
TrainDummys <- model.matrix(  ~ ., data=Train)
yy <- as.data.frame(TrainDummys)
yy <- yy[,-1]

summary(yy)


fit <- glm( HasDetections ~ .,data=yy, family = 'binomial')

summary(fit)